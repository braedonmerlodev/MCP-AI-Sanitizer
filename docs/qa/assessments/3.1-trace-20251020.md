# Requirements Traceability Matrix

## Story: 3.1 - Implement n8n-Compatible API Endpoints

### Coverage Summary

- Total Requirements: 4
- Fully Covered: 1 (25%)
- Partially Covered: 2 (50%)
- Not Covered: 1 (25%)

### Requirement Mappings

#### AC1: Endpoints support n8n's webhook and API calling patterns.

**Coverage: PARTIAL**

Given-When-Then Mappings:

- **Unit Test**: `src/tests/unit/api.test.js::should handle n8n webhook with valid payload`
  - Given: Valid n8n webhook payload sent to POST /api/webhook/n8n
  - When: API processes the request
  - Then: Returns 200 with result containing processed data

- **Unit Test**: `src/tests/unit/api.test.js::should return 400 for invalid n8n payload`
  - Given: Invalid payload sent to POST /api/webhook/n8n
  - When: API processes the request
  - Then: Returns 400 with error

- **Integration Test**: `src/tests/integration/n8n-webhook.test.js::should process n8n webhook end-to-end`
  - Given: n8n webhook payload
  - When: Full request flow through endpoint
  - Then: Payload processed and response returned

Gap: Limited to basic webhook pattern; full n8n API calling patterns not tested.

#### AC2: Sanitization is applied automatically to all n8n requests/responses.

**Coverage: PARTIAL**

Given-When-Then Mappings:

- **Integration Test**: `src/tests/integration/n8n-webhook.test.js::should apply input and output sanitization`
  - Given: Payload with potentially malicious content
  - When: n8n webhook processes through sanitization
  - Then: Sanitization applied to input and output

Gap: Uses mocked sanitization; no test with actual SanitizationPipeline components.

#### AC3: Documentation includes n8n integration examples.

**Coverage: NONE**

No automated tests for documentation content.

#### AC4: End-to-end tests confirm seamless n8n workflows.

**Coverage: PARTIAL**

Given-When-Then Mappings:

- **Integration Test**: `src/tests/integration/n8n-webhook.test.js::should process n8n webhook end-to-end`
  - Given: n8n webhook payload
  - When: End-to-end flow with mocked dependencies
  - Then: Seamless processing confirmed

Gap: Tests use mocks; no real end-to-end with actual LLM/MCP integration.

### Critical Gaps

1. **Full n8n Pattern Support**
   - Gap: Only basic webhook tested; missing API calling patterns
   - Risk: Medium - May not support all n8n use cases
   - Action: Add tests for additional n8n webhook formats and API calls

2. **Real Sanitization Integration**
   - Gap: Sanitization mocked in tests; no validation with actual pipeline
   - Risk: High - Automatic sanitization not verified
   - Action: Replace mocks with real SanitizationPipeline in integration tests

3. **Documentation Validation**
   - Gap: No tests for documentation accuracy
   - Risk: Low - But examples may be outdated
   - Action: Consider adding documentation validation tests

4. **True E2E Testing**
   - Gap: No tests without mocks for full workflow
   - Risk: Medium - Integration issues may be missed
   - Action: Implement e2e tests with test LLM/MCP services

### Test Design Recommendations

Based on gaps identified, recommend:

1. Additional unit tests for various n8n payload formats
2. Integration tests using real SanitizationPipeline instead of mocks
3. E2E tests with containerized LLM/MCP mocks
4. Documentation linting or validation scripts

### Risk Assessment

- **High Risk**: AC2 (automatic sanitization) - mocked, not real
- **Medium Risk**: AC1 and AC4 - partial coverage with mocks
- **Low Risk**: AC3 - documentation not testable
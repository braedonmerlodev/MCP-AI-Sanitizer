# Story 4.2: Implement Text to Markdown Conversion

## User Story

As a data processor, I want extracted PDF text to be converted into structured Markdown, so that document formatting and hierarchy are preserved for downstream processing.

## Acceptance Criteria

1. Raw text extraction output is converted to clean Markdown format.
2. Document structure is preserved (headings, paragraphs, lists where detectable).
3. Special characters and formatting are properly escaped for Markdown compatibility.
4. Page breaks and document sections are clearly marked in Markdown.
5. Document metadata is embedded as YAML frontmatter in the Markdown document.
6. Conversion process handles various PDF layouts and text encodings.
7. Output validation ensures Markdown syntax is valid and readable.

## Implementation Notes

- Process text extracted from PDF (from Story 4.1)
- Implement text structure detection (headings, paragraphs, lists)
- Add YAML frontmatter with document metadata
- Handle special characters and encoding issues
- Validate output Markdown syntax

## Dependencies

- markdown processing libraries (if needed)
- yaml frontmatter library
- text processing utilities

## Validation Checklist ✅

- ✅ **User Story**: Clear and follows proper format for data processing role
- ✅ **Acceptance Criteria**: 7 specific, testable criteria covering text conversion requirements
- ✅ **Technical Feasibility**: Implementation approach is sound using pdf-parse for extraction
- ✅ **Dependencies**: pdf-parse already available, may need additional libraries for Markdown processing
- ✅ **Testable**: All acceptance criteria can be verified through automated tests
- ✅ **Dependency**: Properly depends on Story 4.1 (PDF upload) being completed
- ✅ **Integration**: Can extend existing upload endpoint or create new conversion endpoint

## Required Dependencies to Add

- `gray-matter`: For YAML frontmatter handling
- `markdown-it` or similar: For Markdown processing/validation (optional)
- Text processing utilities may be built-in or use existing sanitization components

## Implementation Approach

**Option 1**: Extend upload endpoint to return both validation confirmation and extracted Markdown
**Option 2**: Create separate `POST /api/documents/convert` endpoint that takes uploaded PDF and returns Markdown
**Option 3**: Modify upload to store PDF temporarily and create conversion endpoint

**Recommended**: Option 1 - Extend upload endpoint for immediate processing and response

## Status

✅ **VALIDATED** - Ready for development

# Fix PDF Text Extraction Issue

## Story Overview

As a developer testing the MCP-Security API, I need PDF upload functionality to work with generated PDFs so that the document processing pipeline is complete and reliable.

## Problem Statement

The PDF upload endpoint fails with "Failed to extract text from PDF" when processing PDFs generated by the `/api/documents/generate-pdf` endpoint. This is due to incompatibility between the PDF generation library (PDFKit) and the text extraction library (pdf-parse).

## Current Behavior

- PDF generation creates valid PDF files using PDFKit
- PDF upload attempts to extract text using pdf-parse
- pdf-parse cannot extract text from PDFKit-generated PDFs
- Results in 400 error: "Failed to extract text from PDF"

## Desired Behavior

- PDF upload successfully extracts and sanitizes text from generated PDFs
- Complete document processing workflow functions end-to-end
- API testing passes for PDF upload scenarios

## Acceptance Criteria

- [ ] PDF upload endpoint returns 200 for PDFs generated by the API
- [ ] Extracted text is properly sanitized and returned
- [ ] New trust token is generated for the processed content
- [ ] No regression in existing PDF processing for user-uploaded PDFs
- [ ] Unit tests added for PDF generation and extraction compatibility

## Technical Details

- **Generation Library**: PDFKit (creates PDFs with embedded fonts)
- **Extraction Library**: pdf-parse (expects standard PDF text encoding)
- **Issue**: PDFKit's font embedding may not be compatible with pdf-parse's text extraction

## Proposed Solutions

1. **Switch PDF generation library** to one more compatible with pdf-parse (e.g., puppeteer with html-to-pdf)
2. **Switch text extraction library** to one that handles PDFKit output better (e.g., pdf2pic + OCR, or pdf-lib)
3. **Modify PDF generation settings** in PDFKit to use standard fonts and encoding
4. **Add fallback text extraction** methods

## Priority

High - Blocks complete API testing and document processing workflow

## Estimation

Medium (2-3 days) - Research compatible libraries, implement changes, test thoroughly

## Dependencies

- PDFKit component in src/components/PDFGenerator.js
- pdf-parse usage in src/routes/api.js (PDF upload endpoint)

## Testing Notes

- Test with both generated PDFs and user-uploaded PDFs
- Verify text extraction accuracy
- Ensure PDF quality and security features remain intact

# Story 1.2: Backend MCP Configuration API

## Status

Draft

## Story

**As a** developer,
**I want to** implement API endpoints to store and retrieve MCP server configurations,
**so that** the frontend can save user preferences and the backend can access connection details.

## Acceptance Criteria

1. Design a data model (or config structure) to store MCP server details (URL, name, auth tokens, active status).
2. Create API endpoints to `GET` available/configured servers.
3. Create API endpoints to `POST/PUT` server configuration (connect/update).
4. Create API endpoint to `POST` the active server selection.
5. Ensure sensitive data (auth tokens) are stored securely (encrypted or environment variable references).
6. Implement a proxy endpoint to fetch the server list from Smithery Registry API (`https://registry.smithery.ai/servers`) to avoid CORS issues on the frontend.

## Tasks / Subtasks

- [ ] Create Mongoose model `src/models/McpServer.js`
- [ ] Implement Controller `src/controllers/McpServerController.js`
  - [ ] `getAllServers`
  - [ ] `addServer`
  - [ ] `updateServer`
  - [ ] `setActiveServer`
  - [ ] `fetchRegistryServers` (Proxy to Smithery)
- [ ] Add routes to `src/routes/api.js` (or new `src/routes/mcp.js`)
- [ ] Implement encryption helper for API keys (if not existing)
- [ ] Add validation schemas (Joi)

## Dev Notes

- Use `src/models` for schema
- Ensure proper error handling
- Follow existing API patterns
- Smithery Registry API: `GET https://registry.smithery.ai/servers`

## Change Log

| Date       | Version | Description   | Author |
| ---------- | ------- | ------------- | ------ |
| 2025-11-30 | 1.0     | Initial draft | PO     |

# Story 1.3: Implement Real MCP Integration in ProxySanitizer

## Status

Draft

## Story

**As a** backend developer,
**I want to** replace the mock `forwardToLLM` method in `src/components/proxy-sanitizer.js` with real MCP client logic,
**so that** data is actually sent to the external server.

## Acceptance Criteria

1. Modify `src/components/proxy-sanitizer.js`.
2. Implement `forwardToLLM(data)` to retrieve the currently active MCP server config.
3. Construct a valid HTTP/RPC request to the MCP server using the `sanitizedData`.
4. Handle network errors and timeouts gracefully.
5. Receive the response and return it for the next stage of the pipeline.
6. Implement the Smithery authentication flow (OAuth provider) as described in their documentation.

## Tasks / Subtasks

- [ ] Import `McpServer` model in `proxy-sanitizer.js`
- [ ] Implement logic to fetch active server
- [ ] Implement HTTP client (axios/fetch) to send data to MCP server
- [ ] Add error handling (try/catch, logging)
- [ ] Ensure response format matches expected output for outbound sanitization
- [ ] Implement OAuth provider logic for Smithery connection (token exchange/refresh)

## Dev Notes

- Use `axios` or native `fetch`
- Ensure timeouts are configured (don't hang forever)
- Log all interactions for debugging
- Reference Smithery docs for OAuth flow: `https://smithery.ai/docs/use/connect`

## Change Log

| Date       | Version | Description   | Author |
| ---------- | ------- | ------------- | ------ |
| 2025-11-30 | 1.0     | Initial draft | PO     |
